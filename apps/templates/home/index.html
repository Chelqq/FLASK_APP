{% extends "layouts/base.html" %}

{% block title %} Control de Servos {% endblock %} 

{% block stylesheets %}
<style>
    .slider-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-top: 20px;
    }
    .servo-selector {
        margin-bottom: 15px;
    }
    .servo-control {
        width: 100%;
        max-width: 400px;
        text-align: center;
    }
    .angle-value {
        font-size: 18px;
        font-weight: bold;
    }
</style>
{% endblock stylesheets %}

{% block content %}
<div class="content">
    <div class="row">
        <div class="col-md-12">
            <h2 class="text-center">Control de 30 Servomotores</h2>
            
            <div class="slider-container">
                <label for="servoSelect"><strong>Selecciona un servo:</strong></label>
                <select id="servoSelect" class="form-control servo-selector">
                    {% for pin in servo_pins %}
                        <option value="{{ pin }}">Servo {{ pin }}</option>
                    {% endfor %}
                </select>

                <br>

                <label for="angleRange"><strong>Ángulo: <span id="angleValue">90°</span></strong></label>
                <input type="range" id="angleRange" class="servo-control" min="0" max="180" value="90" step="1" oninput="updateServo()">
            </div>
        </div>
    </div>
</div>
{% endblock content %}

{% block javascripts %}
<script>
    function updateServo() {
        let servo_id = document.getElementById("servoSelect").value;
        let angle = document.getElementById("angleRange").value;
        document.getElementById("angleValue").innerText = angle + "°";

        fetch('/set_servo', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ servo_id: servo_id, angle: angle })
        })
        .then(response => response.json())
        .then(data => {
            console.log(data);
        })
        .catch(error => console.error('Error:', error));
    }
</script>
{% endblock javascripts %}
